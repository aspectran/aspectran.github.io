<script src="{{ site.baseurl }}/assets/js/foundation.min.js"></script>
<script src="{{ site.baseurl }}/assets/js/jquery.backstretch.min.js"></script>
<script>
  $(document).foundation({
    reveal : {
      animation: 'fade',
      animation_speed: 250
    }
  });
  $(document).ready(function() {
    var navigationFixed = false;
    var navigationHeight = $("#navigation").height();
    var $window = $(window);
    $window.scroll(function() {
      var scrollTop = $window.scrollTop();
      if(navigationFixed) {
       if(scrollTop < navigationHeight) {
         navigationFixed = false;
         $("#navigation").removeClass("fixed");
       }
      } else {
        if(scrollTop > navigationHeight) {
          navigationFixed = true;
          $("#navigation").addClass("fixed");
        }
      }
    });
  });
</script>

{% if page.sidebar == "toc" %}
<script>
  $(document).ready(function() {
    $("#masthead h1, article h1, article h2, article h3, article h4, article h5, article h6").each(function(index, item) {
      var tagn = item.localName;
      var anchor = "top-of-page";
      if(tagn != "h1") {
        anchor = "anchor-" + (index + 1);
        $(this).before("<a class='toc-anchor " + anchor + "' id='" + anchor + "' name='" + anchor + "'></a>");
      }
      $("#toc ul").append("<li class='toc-" + tagn + "'><a anchor='" + anchor + "' href='#" + anchor + "'>" + $(item).text() + "</a></li>");
    });
  });
</script>
{% endif %}

{% if page.sidebar %}
<script>
  $(document).ready(function() {
    $(".lazy-sticky").each(function() {
      var $window = $(window);
      var $this = $(this);
      var topNavHeight = $("#navigation").height();
      var footerHeight = $("#footer-content").height() + $("#up-to-top").height() + 20;
      var baseOffsetTop = $this.offset().top - topNavHeight;
      var offsetTop = 0;
      var thisHeight = $this.height();
      var winHeight = $window.height();
      var scrollTimer = null;
      var immediate = false;
      $this.find("#toc ul a").click(function(e) {
        immediate = true;
        var anchor = $(this).attr("anchor");
        if(anchor != "top-of-page") {
          setTimeout(function() {
            var offset = $("#" + anchor).offset();
            if(offset) {
              immediate = true;
              $window.scrollTop(offset.top - topNavHeight);
            }
          }, 100);
        }
      });
      $window.scroll(function() {
        var scrollTop = $window.scrollTop();
        if(scrollTop < baseOffsetTop) {
          if(scrollTimer) {
            clearInterval(scrollTimer);
            scrollTimer = null;
          }
          scrollTimer = setInterval(function() {
            if(offsetTop != 0) {
              $this.css({
                top: 0
              });
            }
            offsetTop = 0;
            clearInterval(scrollTimer);
            scrollTimer = null;
            immediate = false;
          }, immediate ? 250 : 500);
        } else {
          if(immediate || scrollTop > baseOffsetTop + offsetTop + thisHeight - 20 || scrollTop < baseOffsetTop + offsetTop) {
            var tocOffsetLeftBase = $this.offset().left;
            if(tocOffsetLeftBase > 100) {
              if(scrollTimer) {
                clearInterval(scrollTimer);
                scrollTimer = null;
              }
              scrollTimer = setInterval(function() {
                scrollTop = $window.scrollTop();
                if(scrollTop < baseOffsetTop) {
                  scrollTop = 0;
                } else {
                  scrollTop = scrollTop - baseOffsetTop;
                }
                if(scrollTop > $(document).height() - footerHeight - thisHeight - baseOffsetTop - topNavHeight) {
                  scrollTop = $(document).height() - footerHeight - thisHeight - baseOffsetTop - topNavHeight;
                }
                offsetTop = scrollTop;
                $this.css({
                  position: "relative"
                });
                $this.animate({
                  top: scrollTop + "px"
                }, 300);
                clearInterval(scrollTimer);
                scrollTimer = null;
                winHeight = $window.height();
                thisHeight = $this.height();
                footerHeight = $("#footer-content").height() + $("#up-to-top").height() + 20;
                immediate = false;
              }, immediate ? 250 : 500);
            }
          }
        }
      });
      if($window.scrollTop() > baseOffsetTop) {
        $window.scroll();
      }
    });
  });
</script>
{% endif %}

{% if page.header.image_fullwidth %}
<script>
    $("#masthead").backstretch("{{ site.urlimg }}{{ page.header.image_fullwidth }}", {fade: 700});
</script>
{% endif %}
{% if page.header.image_slide and page.header.image_slide[0] %}
<script>
    $("#masthead").backstretch([
      "{{ site.urlimg }}{{ page.header.image_slide[0] }}"
    {% for image in page.header.image_slide %}
    {% if forloop.index > 1 %}, "{{ site.urlimg }}{{ image }}"{% endif %}
    {% endfor %}
    ], {duration: 3300, fade: 700});
</script>
{% endif %}

{% comment %}
#  Start of Tawk.to Script
#
#  More information in _config.yml
#
{% endcomment %}
{% if site.tawkto_embed_uri and page.tawkto == true %}
<script type="text/javascript">
  var $_Tawk_API={},$_Tawk_LoadStart=new Date();
  (function(){
  var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
  s1.async=true;
  s1.src='{{ site.tawkto_embed_uri }}';
  s1.charset='UTF-8';
  s1.setAttribute('crossorigin','*');
  s0.parentNode.insertBefore(s1,s0);
  })();
</script>
{% endif %}

{% if site.google_translate_website == true %}
{% include google-translate-website %}
{% endif %}
