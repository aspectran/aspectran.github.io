<script src="{{ site.baseurl }}/assets/js/foundation.min.js"></script>
<script src="{{ site.baseurl }}/assets/js/jquery.backstretch.min.js"></script>
<script>
  $(document).foundation({
    reveal : {
      animation: 'fade',
      animation_speed: 250
    }
  });
</script>

{% if page.sidebar == "toc" %}
<script>
  var tocOffsetTopBase = $("#toc").offset().top;
  var tocOffsetTop = 0;
  var tocHeight = 0;
  var tocWinHeight = $(window).height();
  var tocScrollTimer = null;
  $(document).ready(function(){
    $("article h1, article h2, article h3, article h4, article h5, article h6").each(function(index, item) {
      var tagn = item.localName;
      var anchor = "top-of-page";
      if(tagn != "h1") {
        anchor = "anchor-" + (index + 1);
        $(this).before("<a class='toc-anchor " + anchor + "' id='" + anchor + "' name='" + anchor + "'></a>");
      }
      $("#toc ul").append("<li class='toc-" + tagn + "'><a anchor='" + anchor + "' href='#" + anchor + "'>" + $(item).text() + "</a></li>");
    });
    tocHeight = $("#toc").height();
    $("#toc ul a").click(function(e) {
      var anchor = $(this).attr("anchor");
      if(anchor != "top-of-page") {
        setTimeout(function() {
          var offset = $("#" + anchor).offset();
          if(offset) {
            e.preventDefault();
            tocOffsetTop = 0 - tocOffsetTopBase;
            $(window).scrollTop(offset.top - 50);
          }
        }, 500);
      }
    });
    $(window).scroll(function() {
      var scrollTop = $(window).scrollTop();
      if(scrollTop < tocOffsetTopBase) {
        if(tocScrollTimer) {
          clearInterval(tocScrollTimer);
          tocScrollTimer = null;
        }
        tocScrollTimer = setInterval(function() {
          if(tocOffsetTop != 0) {
            $("#toc").css({
              top: 0
            });
          }
          tocOffsetTop = 0;
          clearInterval(tocScrollTimer);
          tocScrollTimer = null;
        }, 600);
      } else {
        if(scrollTop > tocOffsetTop + tocOffsetTopBase + tocHeight || scrollTop < tocOffsetTop + tocOffsetTopBase - tocWinHeight) {
          var tocOffsetLeftBase = $("#toc").offset().left;
          if(tocOffsetLeftBase > 100) {
            if(tocScrollTimer) {
              clearInterval(tocScrollTimer);
              tocScrollTimer = null;
            }
            tocScrollTimer = setInterval(function() {
              scrollTop = $(document).scrollTop();
              if(scrollTop < tocOffsetTopBase) {
                scrollTop = 0;
              } else if(scrollTop > $(document).height() - $("#footer-content").height() - tocHeight - 100) {
                scrollTop = $(document).height() - $("#footer-content").height() - tocHeight - tocOffsetTopBase - 100;
              } else {
                scrollTop = scrollTop - tocOffsetTopBase + 70;
              }
              tocOffsetTop = scrollTop;
              $("#toc").css({
                position: "relative",
                top: scrollTop + "px"
              });
              clearInterval(tocScrollTimer);
              tocScrollTimer = null;
              tocWinHeight = $(window).height();
            }, 600);
          }
        }
      }
    });
    if($(window).scrollTop() > tocOffsetTopBase) {
      $(window).scroll();
    }
  });
</script>
{% endif %}

{% if page.header.image_fullwidth %}
<script>
    $("#masthead").backstretch("{{ site.urlimg }}{{ page.header.image_fullwidth }}", {fade: 700});
</script>
{% endif %}
{% if page.header.image_slide and page.header.image_slide[0] %}
<script>
    $("#masthead").backstretch([
      "{{ site.urlimg }}{{ page.header.image_slide[0] }}"
    {% for image in page.header.image_slide %}
    {% if forloop.index > 1 %}, "{{ site.urlimg }}{{ image }}"{% endif %}
    {% endfor %}
    ], {duration: 3300, fade: 700});
</script>
{% endif %}

{% comment %}
#  Start of Tawk.to Script
#
#  More information in _config.yml
#
{% endcomment %}
{% if site.tawkto_embed_uri and page.tawkto == true %}
<script type="text/javascript">
  var $_Tawk_API={},$_Tawk_LoadStart=new Date();
  (function(){
  var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
  s1.async=true;
  s1.src='{{ site.tawkto_embed_uri }}';
  s1.charset='UTF-8';
  s1.setAttribute('crossorigin','*');
  s0.parentNode.insertBefore(s1,s0);
  })();
</script>
{% endif %}
